-- Тестові дані модуля підтримки
-- Заповнення таблиць підтримки тестовими даними

-- Додаємо тестові теги компаній
INSERT INTO public.company_tags (company_id, title, attention_rank) VALUES 
    (1, 'терміново', 90),
    (1, 'оплата', 70),
    (1, 'технічне', 60),
    (1, 'скарга-клієнта', 85),
    (1, 'запит-функції', 40),
    (1, 'звіт-про-помилку', 80),
    (2, 'терміново', 90),
    (2, 'продажі', 50),
    (2, 'підтримка', 60),
    (2, 'повернення', 75)
ON CONFLICT DO NOTHING;

-- Додаємо тестові типи тікетів для компаній
INSERT INTO dictionaries.msg_ticket_types (company_id, title, priority_rank) VALUES 
    (1, 'Технічна підтримка', 1),
    (1, 'Проблема з оплатою', 2),
    (1, 'Запит функції', 3),
    (1, 'Звіт про помилку', 1),
    (1, 'Загальне питання', 4),
    (2, 'Запит продажу', 1),
    (2, 'Підтримка клієнта', 2),
    (2, 'Запит повернення', 1),
    (2, 'Питання про продукт', 3)
ON CONFLICT DO NOTHING;

-- Спочатку створимо повідомлення в public.company_messages
INSERT INTO public.company_messages (task_id, text, context) VALUES 
    (1, 'Користувач повідомив про проблеми з нагадуваннями про бонуси', 'Користувач: user123, Рейтинг: 5, Дата: 2024-01-15'),
    (2, 'Скарга на рекламу та проблеми з фільтрами продавців', 'Користувач: user123, Рейтинг: 5, Дата: 2024-01-15'),
    (3, 'Проблема з запуском додатку без Google Play', 'Користувач: user123, Рейтинг: 5, Дата: 2024-01-15'),
    (4, 'Скарга на затримки доставки та високу вартість', 'Користувач: user123, Рейтинг: 5, Дата: 2024-01-15'),
    (5, 'Проблеми з гарячою лінією та надмірною рекламою', 'Користувач: user123, Рейтинг: 5, Дата: 2024-01-15')
ON CONFLICT DO NOTHING;

-- Додаємо тестові тікети підтримки
INSERT INTO public.company_support_tickets (
    message_id, 
    status_id, 
    ticket_type_id, 
    tags_array, 
    updated_user_id
) VALUES 
    -- Тікети компанії 1
    (1, 1, 1, ARRAY['терміново', 'технічне'], NULL),
    (2, 2, 2, ARRAY['оплата', 'скарга-клієнта'], NULL),
    (3, 1, 3, ARRAY['запит-функції'], NULL),
    (4, 3, 4, ARRAY['звіт-про-помилку', 'терміново'], NULL),
    (5, 1, 5, ARRAY['загальне'], NULL)
ON CONFLICT DO NOTHING;

-- Використовуємо існуючі повідомлення з crawler.company_messages (task_id 3,4,5,6,7)
-- Ці повідомлення вже існують від успішно виконаних завдань


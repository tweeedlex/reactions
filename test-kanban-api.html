<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Kanban API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .loading { color: #fbbf24; }
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #4f46e5; }
        .feedback-card {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #6366f1;
        }
        .priority-high { border-left-color: #ef4444; }
        .priority-medium { border-left-color: #f59e0b; }
        .priority-low { border-left-color: #10b981; }
        .sentiment-positive { color: #10b981; }
        .sentiment-neutral { color: #f59e0b; }
        .sentiment-negative { color: #ef4444; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç Kanban API</h1>
    
    <div class="section">
        <h2>üìä –¢–µ—Å—Ç API</h2>
        <button onclick="testKanbanAPI()">–¢–µ—Å—Ç Kanban API</button>
        <button onclick="testWithFilters()">–¢–µ—Å—Ç –∑ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏</button>
        <button onclick="clearResults()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
        <div id="apiResult" class="section"></div>
    </div>

    <div class="section">
        <h2>üìã –†–µ–∑—É–ª—å—Ç–∞—Ç–∏</h2>
        <div id="results"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000';

        async function testKanbanAPI() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.innerHTML = '<span class="loading">–¢–µ—Å—Ç—É—î–º–æ Kanban API...</span>';

            try {
                const response = await fetch(`${API_BASE_URL}/feedbacks/prioritized?limit=20`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <span class="success">‚úÖ Kanban API –ø—Ä–∞—Ü—é—î!</span><br>
                        <strong>–ó–Ω–∞–π–¥–µ–Ω–æ –≤—ñ–¥–≥—É–∫—ñ–≤:</strong> ${data.length}<br>
                        <strong>–î–∂–µ—Ä–µ–ª–∞:</strong> ${[...new Set(data.map(f => f.source))].join(', ')}
                    `;
                    displayResults(data);
                } else {
                    resultDiv.innerHTML = `
                        <span class="error">‚ùå Kanban API –ø–æ–º–∏–ª–∫–∞</span><br>
                        <strong>–ü–æ–º–∏–ª–∫–∞:</strong> ${data.message || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'}
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <span class="error">‚ùå –ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è</span><br>
                    <strong>–î–µ—Ç–∞–ª—ñ:</strong> ${error.message}
                `;
            }
        }

        async function testWithFilters() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.innerHTML = '<span class="loading">–¢–µ—Å—Ç—É—î–º–æ –∑ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏...</span>';

            try {
                const response = await fetch(`${API_BASE_URL}/feedbacks/prioritized?source=playstore&limit=10`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <span class="success">‚úÖ –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–∞—Ü—é—î!</span><br>
                        <strong>–ó–Ω–∞–π–¥–µ–Ω–æ –≤—ñ–¥–≥—É–∫—ñ–≤:</strong> ${data.length}<br>
                        <strong>–¢—ñ–ª—å–∫–∏ Google Play:</strong> ${data.every(f => f.source === 'playstore') ? '–¢–∞–∫' : '–ù—ñ'}
                    `;
                    displayResults(data);
                } else {
                    resultDiv.innerHTML = `
                        <span class="error">‚ùå –ü–æ–º–∏–ª–∫–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó</span><br>
                        <strong>–ü–æ–º–∏–ª–∫–∞:</strong> ${data.message || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'}
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <span class="error">‚ùå –ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è</span><br>
                    <strong>–î–µ—Ç–∞–ª—ñ:</strong> ${error.message}
                `;
            }
        }

        function displayResults(feedbacks) {
            const resultsDiv = document.getElementById('results');
            
            if (feedbacks.length === 0) {
                resultsDiv.innerHTML = '<p>–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</p>';
                return;
            }

            const groupedByPriority = {
                high: feedbacks.filter(f => f.priority === 'high'),
                medium: feedbacks.filter(f => f.priority === 'medium'),
                low: feedbacks.filter(f => f.priority === 'low')
            };

            let html = `
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <div>
                        <h3 style="color: #ef4444;">üî¥ –í–∏—Å–æ–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç (${groupedByPriority.high.length})</h3>
                        ${groupedByPriority.high.map(f => createFeedbackCard(f)).join('')}
                    </div>
                    <div>
                        <h3 style="color: #f59e0b;">üü° –°–µ—Ä–µ–¥–Ω—ñ–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç (${groupedByPriority.medium.length})</h3>
                        ${groupedByPriority.medium.map(f => createFeedbackCard(f)).join('')}
                    </div>
                    <div>
                        <h3 style="color: #10b981;">üü¢ –ù–∏–∑—å–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç (${groupedByPriority.low.length})</h3>
                        ${groupedByPriority.low.map(f => createFeedbackCard(f)).join('')}
                    </div>
                </div>
            `;

            resultsDiv.innerHTML = html;
        }

        function createFeedbackCard(feedback) {
            const priorityClass = `priority-${feedback.priority}`;
            const sentimentClass = `sentiment-${feedback.sentiment}`;
            
            return `
                <div class="feedback-card ${priorityClass}">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <span class="sentiment-${feedback.sentiment}" style="font-weight: bold; text-transform: uppercase;">
                            ${feedback.sentiment}
                        </span>
                        <span style="background: #444; padding: 2px 8px; border-radius: 12px; font-size: 12px;">
                            ${feedback.priority}
                        </span>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <strong>${feedback.author}</strong> ‚Ä¢ ${feedback.source}
                    </div>
                    <div style="margin-bottom: 8px; font-size: 14px;">
                        ${feedback.text.substring(0, 100)}${feedback.text.length > 100 ? '...' : ''}
                    </div>
                    <div style="font-size: 12px; color: #888;">
                        –õ–∞–π–∫–∏: ${feedback.likes} ‚Ä¢ –û—Ü—ñ–Ω–∫–∞: ${feedback.totalScore} ‚Ä¢ ${new Date(feedback.date).toLocaleDateString()}
                    </div>
                </div>
            `;
        }

        function clearResults() {
            document.getElementById('apiResult').innerHTML = '';
            document.getElementById('results').innerHTML = '';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ç–µ—Å—Ç—É—î–º–æ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.onload = function() {
            testKanbanAPI();
        };
    </script>
</body>
</html>
